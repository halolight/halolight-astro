---
/**
 * 日历页面
 */
import DashboardLayout from '../../layouts/DashboardLayout.astro';

// 生成当月日历数据
const today = new Date();
const year = today.getFullYear();
const month = today.getMonth();
const daysInMonth = new Date(year, month + 1, 0).getDate();
const firstDayOfMonth = new Date(year, month, 1).getDay();

const monthNames = [
  '一月',
  '二月',
  '三月',
  '四月',
  '五月',
  '六月',
  '七月',
  '八月',
  '九月',
  '十月',
  '十一月',
  '十二月',
];
const weekDays = ['日', '一', '二', '三', '四', '五', '六'];

// 模拟事件数据
const events = [
  { date: 5, title: '项目评审会', type: 'meeting', time: '10:00' },
  { date: 12, title: '客户拜访', type: 'visit', time: '14:00' },
  { date: 15, title: '团队周会', type: 'meeting', time: '09:00' },
  { date: 18, title: '产品发布', type: 'release', time: '10:00' },
  { date: 25, title: '月度总结', type: 'meeting', time: '15:00' },
];

const eventColors: Record<string, string> = {
  meeting: 'bg-blue-500',
  visit: 'bg-green-500',
  release: 'bg-purple-500',
};
---

<DashboardLayout title="日历">
  <div class="space-y-6">
    <div class="flex items-center justify-between">
      <div>
        <h2 class="text-2xl font-bold text-gray-900 dark:text-white">日历</h2>
        <p class="mt-1 text-gray-600 dark:text-gray-400">管理您的日程安排</p>
      </div>
      <button class="btn-primary">添加事件</button>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
      <!-- 日历主体 -->
      <div class="lg:col-span-3 card p-6">
        <div class="flex items-center justify-between mb-6">
          <h3 class="text-xl font-semibold text-gray-900 dark:text-white">
            {year}年 {monthNames[month]}
          </h3>
          <div class="flex gap-2">
            <button class="btn-outline px-3 py-1">上月</button>
            <button class="btn-outline px-3 py-1">今天</button>
            <button class="btn-outline px-3 py-1">下月</button>
          </div>
        </div>

        <!-- 星期标题 -->
        <div class="grid grid-cols-7 mb-2">
          {
            weekDays.map((day) => (
              <div class="text-center text-sm font-medium text-gray-500 dark:text-gray-400 py-2">
                {day}
              </div>
            ))
          }
        </div>

        <!-- 日期网格 -->
        <div class="grid grid-cols-7 gap-1">
          {/* 空白填充 */}
          {
            Array.from({ length: firstDayOfMonth }).map((_value, _index) => (
              <div class="aspect-square p-2" />
            ))
          }
          {/* 日期 */}
          {
            Array.from({ length: daysInMonth }).map((_value, index) => {
              const day = index + 1;
              const isToday = day === today.getDate();
              const dayEvents = events.filter((e) => e.date === day);
              return (
                <div
                  class={`aspect-square p-2 rounded-lg border ${isToday ? 'bg-primary-50 border-primary-300 dark:bg-primary-900/20 dark:border-primary-700' : 'border-transparent hover:bg-gray-50 dark:hover:bg-gray-800/50'}`}
                >
                  <div
                    class={`text-sm ${isToday ? 'font-bold text-primary-700 dark:text-primary-400' : 'text-gray-700 dark:text-gray-300'}`}
                  >
                    {day}
                  </div>
                  <div class="mt-1 space-y-1">
                    {dayEvents.slice(0, 2).map((event) => (
                      <div
                        class={`w-full h-1.5 rounded-full ${eventColors[event.type]}`}
                        title={event.title}
                      />
                    ))}
                  </div>
                </div>
              );
            })
          }
        </div>
      </div>

      <!-- 右侧事件列表 -->
      <div class="card p-6">
        <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">近期事件</h3>
        <div class="space-y-4">
          {
            events.map((event) => (
              <div class="flex items-start gap-3">
                <div class={`w-3 h-3 rounded-full mt-1.5 ${eventColors[event.type]}`} />
                <div>
                  <p class="text-sm font-medium text-gray-900 dark:text-white">{event.title}</p>
                  <p class="text-xs text-gray-500 dark:text-gray-400">
                    {month + 1}月{event.date}日 {event.time}
                  </p>
                </div>
              </div>
            ))
          }
        </div>
      </div>
    </div>
  </div>
</DashboardLayout>
